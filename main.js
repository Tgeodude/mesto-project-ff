(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var r=e.g.document;if(!t&&r&&(r.currentScript&&"SCRIPT"===r.currentScript.tagName.toUpperCase()&&(t=r.currentScript.src),!t)){var o=r.getElementsByTagName("script");if(o.length)for(var n=o.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=o[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();const t=e.p+"6666407ac3aa5af1d5de.jpg";function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n),e.addEventListener("click",a)}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n),e.removeEventListener("click",a)}function n(e){if("Escape"===e.key){const e=document.querySelector(".popup_is-opened");e&&o(e)}}function a(e){e.target.classList.contains("popup")&&o(e.target)}const c={baseUrl:"https://nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"01e322f6-5a17-4f54-81b0-32a26e3c15c6","Content-Type":"application/json"}};function s(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}const i=document.querySelector("#card-template").content;function l(e,t,r,o){const n=i.cloneNode(!0).querySelector(".card"),a=n.querySelector(".card__image"),l=n.querySelector(".card__title"),u=n.querySelector(".card__like-button"),d=n.querySelector(".card__delete-button"),p=document.createElement("span"),m=e.likes||[];return l.textContent=e.name,a.src=e.link,a.alt=e.name,p.classList.add("card__like-count"),p.textContent=m.length,u.after(p),m.some((e=>e._id===o))&&u.classList.add("card__like-button_is-active"),u.addEventListener("click",(()=>{var t;(u.classList.contains("card__like-button_is-active")?(t=e._id,fetch(`${c.baseUrl}/cards/likes/${t}`,{method:"DELETE",headers:c.headers}).then(s)):(e=>fetch(`${c.baseUrl}/cards/likes/${e}`,{method:"PUT",headers:c.headers}).then(s))(e._id)).then((e=>{p.textContent=e.likes.length,u.classList.toggle("card__like-button_is-active")})).catch((e=>console.error(e)))})),a.addEventListener("click",t),e.owner&&e.owner._id===o?d.addEventListener("click",(()=>{var t;(t=e._id,fetch(`${c.baseUrl}/cards/${t}`,{method:"DELETE",headers:c.headers}).then(s)).then((()=>r(n))).catch((e=>console.error(e)))})):d.remove(),n}function u(e){e.remove()}function d(e,t,r){const o=e.querySelector(`#${t.id}-error`);t.classList.remove(r.inputErrorClass),o.textContent="",o.classList.remove(r.errorClass)}function p(e,t,r){!function(e){return e.some((e=>!e.validity.valid))}(e)?(t.classList.remove(r.inactiveButtonClass),t.disabled=!1):(t.classList.add(r.inactiveButtonClass),t.disabled=!0)}function m(e,t){const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);r.forEach((r=>{d(e,r,t)})),p(r,o,t)}document.querySelector(".profile__image").style.backgroundImage=`url(${t})`;const _=document.querySelector(".places__list"),h=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_new-card"),f=document.querySelector(".popup_type_image"),y=document.querySelector(".popup_type_avatar"),b=document.querySelector(".profile__edit-button"),S=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__image"),E=document.querySelectorAll(".popup__close"),L=document.forms["edit-profile"],q=L.elements.name,C=L.elements.description,k=document.querySelector(".profile__title"),$=document.querySelector(".profile__description"),w=document.forms["new-place"],x=w.elements["place-name"],T=w.elements.link,U=document.forms["edit-avatar"],A=U.elements.avatar,B=document.querySelector(".popup__image"),P=document.querySelector(".popup__caption");let j,N="",D="";function I(){const e=L.querySelector(".popup__button"),t=q.value!==N||C.value!==D,r=L.checkValidity();t&&r?(e.classList.remove(J.inactiveButtonClass),e.disabled=!1):(e.classList.add(J.inactiveButtonClass),e.disabled=!0)}function O(e){B.src=e.target.src,B.alt=e.target.alt,P.textContent=e.target.alt,r(f)}b.addEventListener("click",(()=>{N=k.textContent,D=$.textContent,q.value=N,C.value=D,m(L,J),I(),r(h)})),S.addEventListener("click",(()=>{w.reset(),m(w,J),r(v)})),g.addEventListener("click",(()=>{U.reset(),m(U,J),r(y)})),E.forEach((e=>e.addEventListener("click",(()=>{const e=document.querySelector(".popup_is-opened");e&&o(e)})))),L.addEventListener("submit",(e=>{var t,r;e.preventDefault(),(t=q.value,r=C.value,fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:t,about:r})}).then(s)).then((e=>{k.textContent=e.name,$.textContent=e.about,o(h)})).catch((e=>{console.error(e)}))})),w.addEventListener("submit",(e=>{var t,r;e.preventDefault(),(t=x.value,r=T.value,fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:t,link:r})}).then(s)).then((e=>{_.prepend(l(e,O,u,j)),w.reset(),o(v)})).catch((e=>{console.error(e)}))})),U.addEventListener("submit",(e=>{e.preventDefault();var t;(t=A.value,fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:t})}).then(s)).then((e=>{document.querySelector(".profile__image").style.backgroundImage=`url(${e.avatar})`,o(y)})).catch((e=>{console.error(e)}))})),Promise.all([fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(s),fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(s)]).then((e=>{let[t,r]=e;k.textContent=t.name,$.textContent=t.about,document.querySelector(".profile__image").style.backgroundImage=`url(${t.avatar})`,j=t._id,r.forEach((e=>{_.append(l(e,O,u,j))}))})).catch((e=>{console.error(e)}));const J={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{const r=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);p(r,o,e),r.forEach((n=>{n.addEventListener("input",(()=>{!function(e,t,r){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?d(e,t,r):function(e,t,r,o){const n=e.querySelector(`#${t.id}-error`);t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.errorClass)}(e,t,t.validationMessage,r)}(t,n,e),p(r,o,e)}))}))}))}(J),q.addEventListener("input",I),C.addEventListener("input",I)})();